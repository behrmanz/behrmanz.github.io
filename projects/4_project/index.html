<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Pixel Sorting | Zachary Behrman</title> <meta name="author" content="Zachary Behrman"/> <meta name="description" content="Making glitch art via parallel processing."/> <meta name="keywords" content="music, art, umich, technology, music-tech, intern, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé∏</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://behrmanz.github.io/projects/4_project/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://behrmanz.github.io//"><span class="font-weight-bold">Zachary</span> Behrman</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/resume/">resume</a> </li> <div class="toggle-container"> <a id="light-toggle"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </a> </div> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Pixel Sorting</h1> <p class="post-description">Making glitch art via parallel processing.</p> </header> <article> <p>As I‚Äôve been experimenting with computer graphics, I had an interesting thought: Given that GLSL shaders are run in parallel, how could we ‚Äúsort‚Äù pixels?</p> <p>In a parallel environment, a pixel‚Äôs neighbor is non-deterministic (could change if a parallel process swaps said neighboring pixel first). This could lead to infinite loops and other undefined behavior if not properly taken care of.</p> <p>So what do we do? Well, there actually is a computing sub-field dedicated to paralell algorithms (including sorting). The particular algorithm I would like to highlight is the odd-even sort.</p> <p>Essentially, on every iteration the odd-even sort will compare either odd or even adjacent pairs (hence the name) and swap if necessary. Once all pairs have been computed, the following iteration will switch indexing (i.e odd to even, or even to odd) and repeat the same process. A more in-depth explanation can be found on <a href="https://en.wikipedia.org/wiki/Odd%E2%80%93even_sort" target="_blank" rel="noopener noreferrer">here</a>.</p> <p>By using this concept, I created a <a href="https://www.khronos.org/opengl/wiki/Fragment_Shader" target="_blank" rel="noopener noreferrer">fragment shader</a> in <a href="https://derivative.ca/" target="_blank" rel="noopener noreferrer">TouchDesigner</a> to ‚Äúsort pixels‚Äù from left to right based on brightness. The code can be found below:</p> <figure class="highlight"><pre><code class="language-glsl" data-lang="glsl"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td> <td class="code"><pre><span class="k">out</span> <span class="kt">vec4</span> <span class="n">fragColor</span><span class="p">;</span>

<span class="k">uniform</span> <span class="kt">int</span> <span class="n">Frame</span><span class="p">;</span>
<span class="k">uniform</span> <span class="kt">float</span> <span class="n">Threshold</span><span class="p">;</span> <span class="c1">// Pixel values below this threshold value will not move (adjusted based on personal preference).</span>

<span class="c1">// Calculate position of neighboring pixels. (taken from https://docs.derivative.ca/Write_a_GLSL_TOP).</span>
<span class="kt">vec2</span> <span class="nf">input2DOffset</span><span class="p">(</span><span class="kt">int</span> <span class="n">texIndex</span><span class="p">,</span> <span class="kt">int</span> <span class="n">xOffset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">yOffset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="kt">vec2</span><span class="p">(</span><span class="n">vUV</span><span class="p">.</span><span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">xOffset</span><span class="p">)</span> <span class="o">*</span> <span class="n">uTD2DInfos</span><span class="p">[</span><span class="n">texIndex</span><span class="p">].</span><span class="n">res</span><span class="p">.</span><span class="n">s</span><span class="p">),</span>
				<span class="n">vUV</span><span class="p">.</span><span class="n">t</span> <span class="o">+</span> <span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">yOffset</span><span class="p">)</span> <span class="o">*</span> <span class="n">uTD2DInfos</span><span class="p">[</span><span class="n">texIndex</span><span class="p">].</span><span class="n">res</span><span class="p">.</span><span class="n">t</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// Take the average of a pixel's RGB values.</span>
<span class="kt">float</span> <span class="nf">average</span><span class="p">(</span><span class="kt">vec4</span> <span class="n">color</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">color</span><span class="p">.</span><span class="n">g</span> <span class="o">+</span> <span class="n">color</span><span class="p">.</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="c1">// NOTE: vUV.st references UV Coordinate (Between 0-1).</span>
	<span class="c1">// NOTE: uTD2DInfos[0] refers to the first image loaded into the GLSL top (within TouchDesigner).</span>

	<span class="c1">// Whether to look at the left or right neighboring pixel. </span>
	<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">vUV</span><span class="p">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">uTD2DInfos</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">res</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="kt">int</span><span class="p">(</span><span class="n">mod</span><span class="p">(</span><span class="n">Frame</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	
	<span class="c1">// Check for OOB (i.e edge pixel).</span>
	<span class="k">if</span><span class="p">(</span><span class="n">input2DOffset</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span> <span class="o">||</span> <span class="n">input2DOffset</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">.)</span> <span class="p">{</span>
		<span class="n">fragColor</span> <span class="o">=</span> <span class="n">TDOutputSwizzle</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">sTD2DInputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vUV</span><span class="p">.</span><span class="n">st</span><span class="p">));</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kt">vec4</span> <span class="n">neighbor_pixel</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">sTD2DInputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input2DOffset</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
	<span class="kt">vec4</span> <span class="n">curr_pixel</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">sTD2DInputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vUV</span><span class="p">.</span><span class="n">st</span><span class="p">);</span>

	<span class="kt">float</span> <span class="n">neighbor_brightness</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">neighbor_pixel</span><span class="p">);</span>
	<span class="kt">float</span> <span class="n">curr_brightness</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">curr_pixel</span><span class="p">);</span>

	<span class="kt">vec4</span> <span class="n">color</span> <span class="o">=</span> <span class="n">curr_pixel</span><span class="p">;</span>

	<span class="c1">// Check if the neighbor pixel was to the left or right of the current pixel and swap if necessary. </span>
	<span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">.)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">curr_brightness</span> <span class="o">&gt;</span> <span class="n">Threshold</span> <span class="o">&amp;&amp;</span> <span class="n">curr_brightness</span> <span class="o">&lt;=</span> <span class="n">neighbor_brightness</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">color</span> <span class="o">=</span> <span class="n">neighbor_pixel</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">neighbor_brightness</span> <span class="o">&gt;</span> <span class="n">Threshold</span> <span class="o">&amp;&amp;</span> <span class="n">curr_brightness</span> <span class="o">&gt;</span> <span class="n">neighbor_brightness</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">color</span> <span class="o">=</span> <span class="n">neighbor_pixel</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// TDOutputSwizzle ensures consistent behavior between Mac and PC versions.</span>
	<span class="n">fragColor</span> <span class="o">=</span> <span class="n">TDOutputSwizzle</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
<span class="p">}</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>The result is a pixel sorter that efficiently runs in parallel.</p> <div class="row justify-content-center"> <div class="col-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pixel_sorter/in_process.gif-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pixel_sorter/in_process.gif-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pixel_sorter/in_process.gif-1400.webp"></source> <img src="/assets/img/pixel_sorter/in_process.gif" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A visual of the algorithm in-process. </div> <p>Stopping mid-way through can also create some pretty interesting ‚Äúglitchy‚Äù effects. See below for some examples:</p> <div class="row justify-content-center"> <div class="col-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pixel_sorter/example_1-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pixel_sorter/example_1-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pixel_sorter/example_1-1400.webp"></source> <img src="/assets/img/pixel_sorter/example_1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A photo of Chinatown in NYC "glitched". </div> <div class="row justify-content-center"> <div class="col-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/pixel_sorter/example_2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/pixel_sorter/example_2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/pixel_sorter/example_2-1400.webp"></source> <img src="/assets/img/pixel_sorter/example_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> A photo of me. Hi! </div> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> ¬© Copyright 2023 Zachary Behrman. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script src="/assets/js/zoom.js"></script> <script src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>